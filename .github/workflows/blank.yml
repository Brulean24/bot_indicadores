# Nombre de la acción que verás en GitHub
name: Ejecutar Bot de Indicadores

# Define los eventos que disparan la acción
on:
  schedule:
    - cron: '*/15 * * * *'
  # Añade un botón para ejecutar la acción manualmente
  workflow_dispatch:

# Define los trabajos (jobs) que se ejecutarán
jobs:
  build:
    # Sistema operativo en el que se ejecutará el código
    runs-on: ubuntu-22.04

    # Pasos que se ejecutarán en el trabajo
    steps:
      # Paso 1: Descargar tu código del repositorio
      - name: Checkout repository code
        uses: actions/checkout@v3

      # Paso 2: Configurar Python 3.10
      - name: Set up Python 3.10
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      # Paso 3: Instalar TA-Lib desde el código fuente
      - name: Install TA-Lib from source
        run: |
          wget http://prdownloads.sourceforge.net/ta-lib/ta-lib-0.4.0-src.tar.gz
          tar -xzf ta-lib-0.4.0-src.tar.gz
          cd ta-lib/
          ./configure
          sudo make
          sudo make install
          
      # Paso 4: Instalar las dependencias de tu bot (librerías)
      - name: Install Python dependencies
        env:
          LD_LIBRARY_PATH: /usr/local/lib
          TA_LIB_INCLUDE_PATH: /usr/local/include
          TA_LIB_LIBRARY_PATH: /usr/local/lib
          CFLAGS: "-I/usr/local/include"
        run: pip install -r requirements.txt

      # Paso 5: Ejecutar el script de Python con las credenciales secretas
      - name: Run the Python script
        env:
          TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: python bot_indicadores_GL.py
